<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>gmech Actor</title>
</head>
<body>
<h1>gmech Actor</h1>

<ul>
    <li><a href= "#Overview">Overview</a>
    <li><a href= "#Commands">Commands</a>
    <ul>
        <li><a href="#filter">filter <i>filter_number</i></a>
        <li><a href="#focus">focus <i>focus</i></a>
        <li><a href="#focusOffset">focusOffset <i>focusOffset</i></a>
        <li><a href="#init">init</a>
        <li><a href="#parameters">parameters</a>
        <li><a href="#piston">piston <i>piston</i></a>
        <li><a href="#readFilterNames">readFilterNames</a>
        <li><a href="#relPiston">relPiston <i>relPiston</i></a>
        <li><a href="#remap">remap</a>
        <li><a href="#status">status [<i>doQuery</i>]</a>
        <li>Plus: <a href="TclActor.html#Commands">standard commands</a> from <a href="TclActor.html">TclActor</a>
    </ul>
    <li><a href="#Keywords">Keywords</a>
    <ul>
        <li><a href="#BadActuatorStatus">Bad<i>Actuator</i>Status</a>
        <li><a href="#Actuator"><i>Actuator</i>=<i>pos</i></a>
        <li><a href="#ActuatorError"><i>Actuator</i>Error=<i>pos</i></a>
        <li><a href="#ActuatorMoveTime"><i>Actuator</i>MoveTime=<i>elapsed, total</i></a>
        <li><a href="#ActuatorStatus"><i>Actuator</i>Status=0x<i>hex</i></a>
        <li><a href="#DesActuator">Des<i>Actuator</i>=<i>pos</i></a>
        <li><a href="#DesFocus"><i>DesFocus</i>=<i>pos</i></a>
        <li><a href="#Focus"><i>Focus</i>=<i>pos</i></a>
        <li><a href="#FocusOffset"><i>FocusOffset</i>=<i>pos</i></a>
        <li><a href="#gmechConnState">gmechConnState=<i>state, reason</i></a>
        <li><a href="#MaxActuator">Max<i>Actuator</i>=<i>pos</i></a>
        <li><a href="#MinActuator">Min<i>Actuator</i>=<i>pos</i></a>
        <li>Plus: <a href="TclActor.html#Keywords">Standard keywords</a> from <a href="TclActor.html">TclActor</a>
    </ul>
    <li><a href="#VersionHistory">Version History</a>
</ul>

<h2><a name="Overview">Overview</a></h2>

<p>The gmech actor is an interface to the NA2 <a href="http://www.apo.nmsu.edu/Telescopes/HardwareControllers/GuiderMechCommands.html">guide camera mechanical controller</a>, which sets the filter number and focus position of the NA2 off-axis guider.

<p>Gmech actor is based on <a href="TclActor.html">TclActor</a>. As such it has TclActor's <a href="TclActor.html#Commands">standard commands</a> and <a href="TclActor.html#Keywords">standard keywords</a>. There are additional gmech-specific commands and keywords which are described in this manual.

<p>Note: one may command piston or focus and these are related by by a constant offset: piston = focus + focusOffset. The idea is that each instrument at NA2 has its own focus offset, such that when gmech focus = 0 the instrument is in focus if the guide camera is in focus.

<h2><a name="Commands">GMech Commands</a></h2>

<p>In addition to the <a href="TclActor.html#Commands">standard commands</a> from <a href="TclActor.html">TclActor</a>, gmech supports the following commands (none of which are case-sensitive):

<h3><a name="filter">filter <i>filter_number</i></a></h3>

<p>Set the specified filter. Filters numbers are integers, starting at 0.

<h3><a name="focus">focus <i>focus</i></a></h3>

<p>Set the desired focus, in &mu;m.
<blockquote>
    <p>Piston = focus + focusOffset
</blockquote>

<h3><a name="focusOffset">focusOffset <i>focusOffset</i></a></h3>

<p>Set the desired focus offset, in &mu;m, where:
<blockquote>
    <p>Piston = focus + focusOffset
</blockquote>
<p>The piston is changed to preserve the current desired focus (unless the desired focus is unknown). Thus:
<blockquote>
    <p>New focus = current focus<br>
    New piston = current piston + (new focusOffset - current focusOffset)
</blockquote>

<h3><a name="init">init</a></h3>

<p>Stop all motion and initializes the controller. This is the only command that can interrupt the <a href="#remap">remap</a> command.

<p>Note: the init command does not connect disconnected devices; use the <a href="#connDev">connDev</a> for that purpose.

<h3><a name="parameters">parameters</a></h3>

<p>Display parameters such as filter names and motion limits for the actuators. Note: the information is only displayed to the user requesting it.

<h3><a name="piston">piston <i>piston</i></a></h3>

<p>Set the piston of the guider to the specified value in &mu;m.

<h3><a name="readFilterNames">readFilterNames</a></h3>

<p>Read filter names from the file $HOME/config/gmech.filters. The file format as follows:
<ul>
    <li>One data line per filter, consisting of <i>num</i> <i>name</i>, where num an integer 0 through 6
    <li>Blank lines and lines starting with # are ignored
    <li>Excess whitespace is ignored (except within the filter name).
    <li>If a filter number is listed more than once then the last one is used.
</ul>
<p>If the filter names file cannot be found or contains unusable data then an error is reported and the old filter names are retained.

<h3><a name="relPiston">relPiston <i>relPiston</i></a></h3>

<p>Offset the piston, and thus the focus, of the guider by the specified value in &mu;m.
<blockquote>
    <p>New piston/focus = current piston/focus + relPiston.
</blockquote>

<p>Note that there is no separate "relFocus" command because this command does the job.

<h3><a name="remap">remap</a></h3>

<p>Remap the actuators. This commands takes a long time to finish, but if necesary you can interrupt it using the <a href="#init">init</a> command.

<h3><a name="status">status [<i>doQuery</i>]</a></h3>

<p>Display the state of the piston and filter actuators. The output is described in the <a href="#Keywords">Keywords</a> section. If doQuery is specified and is one of no, f, false, 0 or none then the hardware controller is not queried and the reported status is based on the last values read from the controller.

<p>Note: if doQuery is false then the actuator status is only shown to the one user requesting it. This is because such status is considered somewhat less accurate than if it is freshly queried from the hardware controller.

<h2><a name="Keywords">FilterNamesGMech Keywords</a></h2>

<p>Keyword data is output whenever the state of the gmech actor or underlying hardware and hardware controller changes. In addition to the <a href="TclActor.html#Keywords">standard keywords</a> from <a href="TclActor.html">TclActor</a>, gmech supports a number of gmech-specific keywords described here.

<p>Notes:
<ul>
    <li><i>Actuator</i> is a placeholder for Piston or Filter.
    <ul>
        <li>Piston position is in &mu;m.
        <li>Filter "position" is the filter number (an integer starting from 0).
    </ul>
    <li>Numeric values (even integers) will be "NaN" if unknown
    <li>When you first connect you will be shown various status information including your own userID.
    <li>The actor polls the controller to detect change in state (such as the end of a move); thus there will be some delay in reporting change of state.
</ul>

<h3><a name="BadActuatorStatus">Bad<i>Actuator</i>Status</a></h3>

<p>Indicates that <a href="#ActuatorStatus"><i>Actuator</i>Status</a> is bad (one or more bad bits are set). The bad bits are 0-3: limit switches and software position limits.

<h3><a name="Actuator"><i>Actuator</i>=<i>pos</i></a></h3>

<p>Position of the of the actuator.

<h3><a name="ActuatorError"><i>Actuator</i>Error=<i>delta-pos</i></a></h3>

<p>Position error for the actuator (only reported if not moving).

<h3><a name="ActuatorMoveTime"><i>Actuator</i>MoveTime=<i>elapsed, total</i></a></h3>

<p>Elapsed time (sec) and predicted total time (sec) for the current move. This keyword is only reported if the actuator is moving.

<h3><a name="ActuatorStatus"><i>Actuator</i>Status=0x<i>hex</i></a></h3>

<p>Actuator status word. The bits are as follows:

<table border=1>
<tr><td>Bit</td><td>Hex</td><td>Meaning</td></tr>
<tr><td>0</td><td>0x01</td><td>Limit switch 1 engaged</td></tr>
<tr><td>1</td><td>0x02</td><td>Limit switch 2 engaged</td></tr>
<tr><td>2</td><td>0x04</td><td>At maximum position (software limit)</td></tr>
<tr><td>3</td><td>0x08</td><td>At minimum position (software limit)</td></tr>
<tr><td>4</td><td>0x10</td><td>At requested position (move successful)</td></tr>
<tr><td>5</td><td>0x20</td><td>Actuator powered down (move complete)</td></tr>
</table>

<h3><a name="DesActuator">Des<i>Actuator</i>=<i>pos</i></a></h3>

<p>Desired (commanded) position of actuator.

<h3><a name="DesFocus">DesFocus=<i>pos</i></a></h3>

<p>Desired (commanded) focus.

<h3><a name="FilterNames">FilterNames=<i>name1</i>, <i>name2</i>, ...</a></h3>

<p>The name of each filter, in increasing numerical order. Each name is "" if the filter position is blank and "?" if the filter is unknown. The name may contain spaces or other special characters.

<h3><a name="Focus">Focus=<i>pos</i></a></h3>

<p>Current focus.

<h3><a name="FocusOffset">FocusOffset=<i>pos</i></a></h3>

<p>Focus offset.

<h3><a name="gmechConnState">gmechConnState=<i>state, reason</i></a></h3>

<p>State of connection to the gmech hardware controller. <i>State</i> is one of Connecting, Authorizing, Connected, Disconnecting, Failing, Disconnected or Failed (the states of an RO.Comm.TCPConnection object). <i>Reason</i> is the reason it got to this state ("" if no reason given).

<h3><a name="MaxActuator">Max<i>Actuator</i>=<i>pos</i></a></h3>

<p>Maximum position of the of the actuator that may be commanded (inclusive).

<h3><a name="MinActuator">Min<i>Actuator</i>=<i>pos</i></a></h3>

<p>Minimum position of the of the actuator that may be commanded (inclusive).

<h2><a name="VersionHistory">Version History</a></h2>

<h3>1.0rc1 2008-07-09</h3>

<ul>
    <li>Minor cleanups prompted by pychecker.
</ul>

<h3>1.0b4 2008-02-11</h3>

<ul>
    <li>Added the relPiston command.
    <li>Bug fix: piston and filter commands were never reported as finished.
</ul>

<h3>1.0b3 2008-02-01</h3>

<ul>
    <li>Made output of <i>Actuator</i>Error more reliable (it was only shown as a move ended).
    <li>Modified so INIT does not clear status (only REMAP and losing the connection do that).
</ul>

<h3>1.0b2 2008-01-30</h3>

<ul>
    <li>Added support for focus and focus offset.
    <li>Added parameters command.
    <li>Added basic support for filter names, including readFilterNames command.
    <li>Added doQuery argument to status command.
</ul>

<h3>1.0b1 2008-01-25</h3>

<p>The first beta release.

</body>
</html>
